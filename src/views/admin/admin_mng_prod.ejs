<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="/static/css/admin/default/default.css" rel="stylesheet">
    <link href="/static/css/admin/prod/admin_mng_prod.css" rel="stylesheet">
    <%- include("../default/header.ejs") %>
</head>
<body>
    <%- include("../admin/default/admin_menu.ejs") %>
    <div class="body">
        <h2>상품관리</h2>
        <div class="prod_search_wrapper">
            <input class="prod_search" type="text">
            <input class="prod_search_btn" type="button" value="검색">
        </div>
        <div class="mng_prod_body_wrapper">
            <div class="mng_prod_table_wrapper">
                <table class="mng_prod_table" width="1200">
                    <thead>
                        <tr>
                            <th class="title" width="60px">선택</th>
                            <th class="title" width="120px">게시글 번호</th>
                            <th class="title" width="120px">판매자</th>
                            <th class="title" width="250px">제목</th>
                            <th class="title" width="120px">가격</th>
                            <th class="title" width="150px">사진</th>
                            <th class="title" width="100px">상태</th>
                            <th class="title" width="100px">거래방식</th>
                            <th class="title" width="100px">상품상태</th>
                            <th class="title" width="150px">상세</th>
                            <th class="title" width="100px">거래현황</th>
                            <th class="title" width="100px">조회수</th>
                            <th class="title" width="150px">지역</th>
                            <th class="title" width="150px">지역상세</th>
                            <th class="title" width="450px">생성시간</th>
                            <th class="title" width="150px">카테고리</th>
                            <th class="title" width="150px">구매자</th>
                            <th class="title" width="150px">구매자 승인</th>
                            <th class="title" width="150px">판매자 승인</th>
                        </tr>
                    </thead>
                    <tbody class="prod_list">
                        <% let cnt=0; pageContent.forEach((item) => {  %>
                            <tr class="content_tr">
                                <td class="content"><input class="checkbox" type="checkbox" id="<%=item.INFO_ID%>" onclick="checkBox(`<%=item.INFO_ID%>`)"></td>
                                <td class="content"><%=item.BOARD_NUM%></td>
                                <td class="content"><%=item.BOARD_ID%></td>
                                <td class="content"><%= item.BOARD_TITLE %></td>
                                <td class="content" style="text-align: right;"><%=item.BOARD_PRICE%> 원</td>
                                <td class="content"><%=item.BOARD_IMG%></td>
                                <td class="content"><%=item.BOARD_CONDITION%></td>
                                <td class="content"><%=item.BOARD_TRADEWAY%></td>
                                <td class="content"><%=item.BOARD_POLLUTION%></td>
                                <td class="content"><%=item.BOARD_DETAIL%></td>
                                <td class="content"><%=item.BOARD_ISTRADING%></td>
                                <td class="content"><%=item.BOARD_VIEWS%></td>
                                <td class="content"><%=item.BOARD_REGION%></td>
                                <td class="content"><%=item.BOARD_REGIONDETAIL%></td>
                                <td class="content"><%=item.BOARD_CREATETIME%></td>
                                <td class="content"><%=item.BOARD_CATEGORY%></td>
                                <td class="content"><%=item.BOARD_BUYERID%></td>
                                <td class="content"><%=item.BOARD_ISBUYEROK%></td>
                                <td class="content"><%=item.BOARD_ISSELLEROK%></td>
                            </tr>
                        <% cnt++ })  %>
                    </tbody>
                </table>
            </div>
            <div class="mng_prod_bot_nav">
                <label class="mng_prod_nav_label">총 <%=total['COUNT(*)']%> 건의 게시글 정보 조회</label>
                <div class="mng_prod_paging_wrapper">
                    <% for (let i = 1; i <= page; i++) { %>
                        <a href="/admin/mng_prod?page=<%=i%>" class="paging" href=""><%=i%></a>
                        
                    <% } %>
                </div>
                <div class="mng_prod_bot_nav_input_wrapper">
                    <input class="mng_prod_add" onclick="location.href='/admin/mng_prod_add'" type="button" value="추가">
                    <input class="mng_prod_modify" type="button" value="변경">
                    <input class="mng_prod_delete" type="button" value="삭제">
                </div>
            </div>
        </div>
    </div>


    <script>
        const table = document.querySelector(".mng_prod_table")
        var mousedown = false; //마우스를 누른 상태
        var td = "";           //사이즈 변경할 td
        var td_width;          //변경할 td의 width,
        var x = 0;             //마우스 드레그전 가로위치

        function TCstartColResize(obj){
            mousedown = true;
            td = obj;
            td_width = td.offsetWidth;
            x = event.clientX;
            distY=0;
            distZ = 0;
        }

        function TCColResize()
        {
            if (mousedown){
                    var distX = event.x - x; //이동한 간격
                    td.style.width = parseInt(td_width) + parseInt(distX)+"px";
                    distZ = distX - distY
                    // table.style.width = table.style.width + parseInt(distZ) + "px";
                    distY = distX
            }
        }

        function TCstopColResize(){
            mousedown = false;
            td = '';
        }

        function cell_left(obj){//마우스가 셀의 왼쪽인지 측정
            if(event.offsetX < 10 && obj.className == "title"){
                return true;
            } else {
                return false;
            }
        }

        function cell_right(obj){//마우스가 셀의 오른쪽인지 측정
            if(event.offsetX > obj.offsetWidth-10) {
                return true;
            } else {
                return false;
            }
        }

        //리사이즈시작
        document.onmousedown = function(){
        try{
            var now_mousedown = window.event.srcElement;
            if(now_mousedown.className.toUpperCase()=="TITLE"){
                    if( cell_left(now_mousedown) ){
                            now_mousedown = now_mousedown.parentNode.childNodes[now_mousedown.cellIndex*2 -1];
                    }else if( !cell_right(now_mousedown) ){
                            return true;//오른쪽도 왼쪽도 아니면 사이즈 조절 안함
                    }
                    TCstartColResize(now_mousedown);
            }
        }catch(e){ return true; }
        }

        //리사이즈
        document.onmousemove = function(){
        try{
            var now_mousemove = window.event.srcElement;
            if(now_mousemove.className.toUpperCase()=="TITLE" || td!=""){

                    //셀의 가장자리면 마우스 커서 변경
                    if( cell_left(now_mousemove) || cell_right(now_mousemove) ){
                            now_mousemove.style.cursor = "col-resize";
                        }else{
                            now_mousemove.style.cursor = "";
                    }

                    TCColResize(now_mousemove);
            }else{
                    now_mousemove.style.cursor = "";
            }
        }catch(e){ return true; }
        }

        //리사이즈종료
        document.onmouseup = function(){
        try{
            var now_mouseup = window.event.srcElement;
            //if(now_mouseup.className=="colResize"){
                    TCstopColResize("mouseup : ", now_mouseup);
            //}
        }catch(e){ return true; }
        }

        //리사이즈 도중 텍스트 선택 금지
        document.onselectstart = function(){
        try{
            if(td != ""){
                return false;
            }
        }catch(e){ return true; }
        }





        // 테이블의 행을 클릭하면 체크박스 선택되게끔
        // const contentTr = document.querySelectorAll(".content_tr")
        // const chkBox = document.querySelectorAll(".checkbox")
        // for (let i = 0; i < contentTr.length; i++) {
        //     contentTr[i].addEventListener("click", function() {
        //         if (chkBox[i].checked == true) {
        //             chkBox[i].checked = false
        //         } else {
        //             chkBox[i].checked = true
        //         }
        //     })
        // }

        let arr = [];
        function checkBox (itemId) {
            const result = document.getElementById(itemId)
            if (result.checked) {
                console.log(itemId,"선택")
                arr.push(itemId)
                console.log(arr)
            } else {
                console.log(itemId,"해제")
                arr = arr.filter(item => item != itemId)
                console.log(arr)
            }
        }

        const delMem = document.querySelector(".mng_prod_delete");
        delMem.addEventListener("click", function () {
            if (arr.length > 0) {
                if (confirm(`${arr.length}개의 상품을 삭제하시겠습니까?`)){
                    let params = arr.map(item => `arr=${item}`).join("&");
                    location.href=`/admin/mng_mem_del/?${params}`
                }
            } else {
                alert("삭제할 상품을 선택해주세요")
            }
        })

        const modMem = document.querySelector(".mng_prod_modify");
        modMem.addEventListener("click", function () {
            if (arr.length == 1) {
                location.href=`/admin/mng_prod_mod/?id=${arr}`
            } else if (arr.length == 0 ) {
                alert("변경할 상품을 선택해주세요");
            } else {
                alert("변경할 상품 한개만 선택해주세요");
            }
        })

    </script>
    <%- include("../default/footer.ejs") %>
</body>
</html>
