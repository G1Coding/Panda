<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>상품등록</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="/resources/css/board/form.css">
</head>

<body>
    <div class="form-container  ">
        <div class="div-gap " style="display: flex; justify-content: flex-end;">
            <a href="/">
                <button style="border: none; background-color: transparent;">
                    <img src="/resources/upload/x.png" alt="x이미지" height="20px">
                </button>
            </a>
        </div>

        <!-- form1에서 사용할 이미지 -->
        <img id="formImage1" src="/resources/upload/form1_panda.png" class="form-image ">
        <!-- form2와 form3에서 사용할 이미지들은 각각 다른 위치로 배치하고 필요에 따라 hidden 클래스를 사용하여 화면에 표시할 수 있습니다. -->
        <img id="formImage2" src="/resources/upload/form2_panda.png" class="form-image hidden">
        <img id="formImage3" src="/resources/upload/form3_panda.png" class="form-image hidden">


        <div class="div-gap" style="height: 80px;"></div>

        <!-- 프로그래스 바 -->
        <div class="progress-container ">
            <div class="progress ">
                <div class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0"
                    aria-valuemax="100"></div>
            </div>
            <!-- 메시지 텍스트 -->
            <div class="message-text">모든 값을 입력해주세요!</div>
            <div class="progress-text">
                <span id="progressNum">currentStep</span> / 3 <!-- /3은 그냥 출력, currentStep은 그룹화-->
            </div>
        </div>

        <!-- 공간 띄우기 -->
        <div class="div-gap bg-white " style="height: 20px; border-bottom: 1px solid rgb(232, 232, 232);"></div>
        <div class="div-gap bg-white " style="height: 20px;"></div>

        <!-- 이 부분 id값에 따라 변함(상품 등록하기/상세정보/거래방식) 
        처음은 상품 등록하기-->
        <div id="formTitle">상품 등록하기</div>

        <!-- 폼 1 (상품 등록) -->
        <form id="form1" class="form ">
            <!-- <div class="div-gap  " style="height: 24px;"></div> -->

            <!-- 공간 띄우기 -->
            <div class="div-gap bg-white" style="height: 24px;"></div>
            <div class="input-group">
                <label for="productName">상품 이름</label>
                <input type="text" id="productName" name="productName" required>
            </div>

            <div class="input-group">
                <label for="productPrice">상품 가격</label>
                <input type="number" id="productPrice" name="productPrice" required>
            </div>

            <div class="input-group">
                <label for="productCategory">카테고리</label>
                <form id="surveyForm" action="/submit" method="post">

                    <div class="form-group">
                        <div class="row">
                            <div class="col">
                                <select class="form-control" name="category1" onchange="changeCategory(this.value)"
                                    id="category1" required>
                                    <option value="">카테고리를 선택해주세요</option>
                                    <option value="옷">옷</option>
                                    <option value="전자기기">전자기기</option>
                                    <option value="필기도구">필기도구</option>
                                </select>
                                <small id="category1Error" class="error-message" style="display: none;">카테고리를
                                    선택해주세요.</small>
                            </div>
                            <div class="col">
                                <select class="form-control" name="category2" onchange="changeCategory2(this.value)"
                                    id="category2" disabled required>
                                    <option value="">하위 카테고리</option>
                                </select>
                                <small id="category2Error" class="error-message" style="display: none;">하위 카테고리를
                                    선택해주세요.</small>
                            </div>
                            <div class="col">
                                <select class="form-control" name="category3" id="category3" disabled required>
                                    <option value="">하위 카테고리</option>
                                </select>
                                <small id="category3Error" class="error-message" style="display: none;">하위 카테고리를
                                    선택해주세요.</small>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </form>

        <!-- 폼 2 (거래 방식) -->
        <form id="form2" class="form hidden">

            <!-- 공간 띄우기 -->
            <div class="div-gap " style="height: 24px;"></div>
            <div class="input-group">
                <label for="productImage">상품 이미지</label>
                <input type="file" id="productImage" name="productImage" required>
            </div>

            <!-- 공간 띄우기 -->
            <div class="div-gap " style="height: 12px;"></div>

            <div class="input-group">
                <label for="productCondition">상품 상태</label>
                <input type="text" id="productCondition" name="productCondition" required>
            </div>
            <!-- 공간 띄우기 -->
            <div class="div-gap " style="height: 12px; "></div>

            <div class="input-group">
                <label for="productContamination">오염 정도</label>
                <input type="number" id="productContamination" name="productContamination" required>
            </div>

            <!-- 공간 띄우기 -->
            <div class="div-gap " style="height: 12px;"></div>

            <div class="input-group">
                <label for="productDetails">상세 정보</label>
                <textarea id="productDetails" name="productDetails" rows="4" required></textarea>
            </div>
        </form>

        <!-- 폼 3 (배송 방법) -->
        <form id="form3" class="form hidden">
            <!-- 공간 띄우기 -->
            <div class="div-gap " style="height: 24px;"></div>
            <div class="input-group">
                <label for="transactionMethod">거래 방식</label>
                <input type="text" id="transactionMethod" name="transactionMethod" required>
            </div>
            <!-- 공간 띄우기 -->
            <div class="div-gap " style="height: 12px;"></div>
            <div class="input-group">
                <label for="location">위치</label>
                <input type="text" id="location" name="location" required>
            </div>

            <!-- 공간 띄우기 -->
            <div class="div-gap " style="height: 12px;"></div>
            <div class="input-group">
                <label for="locationDetails">위치 상세</label>
                <input type="text" id="locationDetails" name="locationDetails" required>
            </div>
        </form>

        <!-- 버튼 컨테이너 시작 -->
        <div class="button-container d-flex justify-content-between gap-3">
            <button type="button" class="my-btn" onclick="showForm('form2')">다음</button>
        </div>
        <!-- 버튼 컨테이너 끝 -->
    </div>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            updateProgress('form1');
        });
        // 입력값이 비어 있는지 확인하는 함수
        function checkInputFields(formId) {
            const form = document.getElementById(formId);
            const inputFields = form.querySelectorAll('input, select, textarea');
            let isValid = true;

            inputFields.forEach(function (input) {
                if (!input.value.trim()) {
                    input.classList.add('error-border');
                    isValid = false;
                } else {
                    input.classList.remove('error-border');
                }
            });

            return isValid;
        }

        function showForm(formId) {

            // 현재 보여지는 폼에 대한 입력값이 비어 있는지 확인
            if (formId === 'form2' && !checkInputFields('form1')) {
                return; // form1의 입력값이 비어 있으면 다음 단계로 진행하지 않음
            } else if (formId === 'form3' && !checkInputFields('form2')) {
                return; // form1의 입력값이 비어 있으면 다음 단계로 진행하지 않음
            }
            // 모든 폼을 숨김
            document.querySelectorAll('.form').forEach(function (form) {
                form.classList.add('hidden');
            });

            // 해당하는 폼만 보이도록 설정
            document.getElementById(formId).classList.remove('hidden');



            // 진행률 업데이트
            updateProgress(formId);


            // formTItle, button 업데이트
            //form1의 경우 다음 버튼만 보이도록 설정, title = 상품 등록하기
            const formTitle = document.getElementById('formTitle'); // formTItle인 id로 값을 갈아끼울거임.
            const formImage1 = document.getElementById('formImage1');
            const formImage2 = document.getElementById('formImage2');
            const formImage3 = document.getElementById('formImage3');


            if (formId === 'form1') {

                formTitle.textContent = "상품 등록하기"; // textContent: 요소의 내용을 문자열로 반환
                document.querySelector('.button-container').innerHTML = `
                    <button type="button" class="my-btn" onclick="showForm('form2')">다음</button>
                `;
                // 보이는 이미지 설정
                formImage1.src = "/resources/upload/form1_panda.png"; //이전 버튼이 눌리면 원래로 돌아오도록

                formImage1.classList.remove('hidden');
                formImage2.classList.add('hidden');
                formImage3.classList.add('hidden');





            }
            // form2의 경우 이전 버튼과 다음 버튼을 보이도록 설정, title = 상품 등록하기
            else if (formId === 'form2') {
                formTitle.textContent = "상품 상세 정보";

                document.querySelector('.button-container').innerHTML = `
                    <button type="button" class="my-btn" onclick="showForm('form1')">이전</button>
                    <button type="button" class="my-btn" onclick="showForm('form3')">다음</button>
                `;
                // 보이는 이미지 설정    

                formImage1.src = "/resources/upload/leaf.png"; // formImage1을 a.png로 변경
                formImage2.src = "/resources/upload/form2_panda.png"; //이전 버튼이 눌리면 원래로 돌아오도록

                formImage2.classList.remove('hidden');
                formImage3.classList.add('hidden');


            }


            // form3의 경우 이전 버튼과 제출하기 버튼을 보이도록 설정
            else if (formId === 'form3') {
                formTitle.textContent = "거래 방법";

                //경로 이동되게
                document.querySelector('.button-container').innerHTML = `
                    <button type="button" class="my-btn" onclick="showForm('form2')">이전</button>
                    <a class="my-btn" onclick="submitForm()" style="text-align: center">제출하기</a>
                `;


                //  document.querySelector('.button-container').innerHTML = `
                //     <button type="button" class="my-btn" onclick="showForm('form2')">이전</button>
                //     <form action="/addData" method="POST" class="my-btn" onclick="submitForm()" style="text-align: center">제출하기</a>
                // `;
                // 보이는 이미지 설정
                formImage1.src = "/resources/upload/leaf.png"; // formImage1을 a.png로 변경
                formImage2.src = "/resources/upload/leaf.png"; // formImage1을 a.png로 변경

                formImage3.classList.remove('hidden');


            }


        }

        function updateProgress(formId) {

            const forms = ['form1', 'form2', 'form3'];
            const currentStep = forms.indexOf(formId) + 1;
            const progress = (currentStep / forms.length) * 100;
            const progressBar = document.querySelector('.progress-bar');

            // 진행률 업데이트 (1/3)이런 거
            const progressNum = document.getElementById('progressNum');
            progressNum.textContent = currentStep;

            // 각 단계에 따라 프로그래스 바의 스타일 업데이트
            if (currentStep === 1) {
                progressBar.style.width = '33.33%'; // 전체 길이의 1/3
                progressBar.style.backgroundColor = 'rgb(173, 216, 230)'; // 옅은 하늘색
            } else if (currentStep === 2) {
                progressBar.style.width = '66.66%'; // 전체 길이의 2/3
                progressBar.style.backgroundColor = 'rgb(143, 176, 234)'; // 하늘색
            } else if (currentStep === 3) {
                progressBar.style.width = '100%'; // 전체 길이의 3/3
                progressBar.style.backgroundColor = 'rgb(100, 149, 237)'; // 파란색
            }
        }

        function submitForm() {
            // Form 1
            const productName = document.getElementById('productName').value;
            const productPrice = document.getElementById('productPrice').value;
            const category1 = document.getElementById('category1').value;
            const category2 = document.getElementById('category2').value;
            const category3 = document.getElementById('category3').value;

            // Form 2
            const productImage = document.getElementById('productImage').value;
            const productCondition = document.getElementById('productCondition').value;
            const productContamination = document.getElementById('productContamination').value;
            const productDetails = document.getElementById('productDetails').value;

            // Form 3
            const transactionMethod = document.getElementById('transactionMethod').value;
            const location = document.getElementById('location').value;
            const locationDetails = document.getElementById('locationDetails').value;

            // 모든 데이터 모여라 (productName:productName)
            const data = {
                productName, productPrice, category1, productImage, productCondition, productContamination,
                productDetails, transactionMethod, location, locationDetails
            };

            console.log(data);
            // Send the data to the controller
            sendDataToController(data);
        }


        function sendDataToController(data) {
            // Convert data to JSON string
            const jsonData = JSON.stringify(data);

            // Create a form element
            const form = document.createElement('form');
            form.action = "/board/submitForm"; // Controller 경로
            form.method = "POST";

            // Create an input field to hold the JSON data
            const dataField = document.createElement('input');
            dataField.type = 'hidden';
            dataField.name = 'data';
            dataField.value = jsonData;

            // Append the data input field to the form
            form.appendChild(dataField);

            // Append the form to the document body
            document.body.appendChild(form);

            // Submit the form
            form.submit();
        }

        // 폼 검증 및 오류 표시
        function checkInputFields(formId) {
            const form = document.getElementById(formId);
            const inputFields = form.querySelectorAll('input, select, textarea');
            let isValid = true;

            inputFields.forEach(function (input) {
                if (!input.value.trim()) {
                    input.classList.add('error-border');
                    isValid = false;
                } else {
                    input.classList.remove('error-border');
                }
            });

            return isValid;
        }

        // 입력값이 없는 경우 테두리를 빨간색으로 강조
        document.querySelectorAll('input, select, textarea').forEach(function (input) {
            input.addEventListener('input', function () {
                if (!this.value.trim()) {
                    this.classList.add('error-border');
                } else {
                    this.classList.remove('error-border');
                }
            });
        });

        function changeCategory(value) {
            const category2Dropdown = document.getElementById('category2');
            const category3Dropdown = document.getElementById('category3');

            category2Dropdown.disabled = false;
            category2Dropdown.innerHTML = '';
            category2Dropdown.innerHTML += '<option value="">하위 카테고리</option>';

            if (value === '옷') {
                category2Dropdown.innerHTML += '<option value="상의">상의</option>';
                category2Dropdown.innerHTML += '<option value="하의">하의</option>';
                category2Dropdown.innerHTML += '<option value="아우터">아우터</option>';
                category2Dropdown.innerHTML += '<option value="원피스">원피스</option>';
            }
            else if (value === '전자기기') {
                category2Dropdown.innerHTML += '<option value="pc">pc</option>';
                category2Dropdown.innerHTML += '<option value="노트북">노트북</option>';
                category2Dropdown.innerHTML += '<option value="핸드폰">핸드폰</option>';
            }
            else if (value === '필기도구') {
                category2Dropdown.innerHTML += '<option value="연필">연필</option>';
                category2Dropdown.innerHTML += '<option value="공책">공책</option>';
                category2Dropdown.innerHTML += '<option value="형광펜">형광펜</option>';
            }

            category3Dropdown.disabled = true;
            category3Dropdown.innerHTML = '';
            category3Dropdown.innerHTML += '<option value="">하위 카테고리</option>';
        }

        function changeCategory2(value) {
            const category3Dropdown = document.getElementById('category3');

            category3Dropdown.disabled = false;
            category3Dropdown.innerHTML = '';
            category3Dropdown.innerHTML += '<option value="">하위 카테고리</option>';

            if (value === '상의' || '하의' || '아우터' || '원피스') {
                category3Dropdown.innerHTML += '<option value="기타">기타</option>';

            }
            else if (value === 'pc' || '노트북' || '핸드폰') {
                category3Dropdown.innerHTML += '<option value="기타">기타</option>';
            }
            else if (value === '연필' || '공책' || '형광펜') {
                category3Dropdown.innerHTML += '<option value="기타">기타</option>';
            }
        }
    </script>
</body>
</html>